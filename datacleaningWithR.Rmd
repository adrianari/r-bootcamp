---
title: "Untitled"
author: "Salome Isch, Adriana Ricklin"
date: "10 9 2020"
output: html_document
---
### Content

**1.   Dataset**    
**1.1  Preparation of the datasets**    

**2.   Models**   
**2.1    


***  

Dataset: 2019_verkehrszaehlungen_werte_fussgaenger_velo
This document shows the quarter hourly count of pedestrians and bikers passing at different counting stations. Source: https://data.stadt-zuerich.ch/dataset/ted_taz_verkehrszaehlungen_werte_fussgaenger_velo/resource/33b3e7d3-f662-43e8-b018-e4b1a254f1f4?inner_span=True

**Columns**    
FK_ZAEHLER 2 levels, pedestrians or bikers
FK_STANDORT5 stations
DATUM      data quarter hourly
VELO_IN    number of bikers, direction in
VELO_OUT   number of bikers, direction out
FUSS_IN    number of pedestrians, direction in
FUSS_OUT   number of pedestrians, direction out
OST        coordinate according to CH1903+ / LV95
NORD       coordinate according to CH1903+ / LV95

  
Dataset: wetter  
***

### 1. Dataset

```{r}
# 1.1.1 Libraries
library(dplyr)
library(stringr)
library(dplyr)

```


```{r}
#get working directory
getwd()
```
```{r}
#read in data
zaehlung <- read.csv("2019_verkehrszaehlungen_werte_fussgaenger_velo_bereinigt.csv", sep=";", header = TRUE)
colnames(zaehlung)[1] <- "FK_ZAEHLER"
#structure of the dataset
str(zaehlung)
head(zaehlung)

wetter <- read.csv("wetter.csv", sep=";", header = TRUE)
#structure of the dataset
str(zaehlung)
head(zaehlung)
```
##### **1.1 Preparation of the datasets**
```{r}
#1.1.1 Prepare dataset pedestrians and bikers
##changing the FK_ZAEHLER to an indicator if bike or pedestrians are measured
zaehlung$FK_ZAEHLER <- as.character(zaehlung$FK_ZAEHLER)
zaehlung$FK_ZAEHLER[zaehlung$FK_ZAEHLER == "U15G3104443"] <- "fussgaenger"
zaehlung$FK_ZAEHLER[zaehlung$FK_ZAEHLER == "U15G3104446"] <- "fussgaenger"
zaehlung$FK_ZAEHLER[zaehlung$FK_ZAEHLER == "ECO09113499"] <- "velo"
zaehlung$FK_ZAEHLER[zaehlung$FK_ZAEHLER == "ECO07091438"] <- "velo"
zaehlung$FK_ZAEHLER <- as.factor(zaehlung$FK_ZAEHLER)
zaehlung$FK_STANDORT <- as.factor(zaehlung$FK_STANDORT)

#only show hours not minutes
zaehlung$DATUM <- str_sub(zaehlung$DATUM, end = -4)

#getting the total of movements, independent from their direction
zaehlung[is.na(zaehlung)] <- 0
zaehlung[, "IN"] <- zaehlung[4]+zaehlung[6]
zaehlung[, "OUT"] <- zaehlung[5] + zaehlung[7]
zaehlung[, "UNIDIR"] <- zaehlung[4] + zaehlung [5] + zaehlung[6] +  zaehlung[7]

#
zaehlung[, "TAGESZEIT"] <-str_sub(zaehlung$DATUM, 12)
zaehlung$TAGESZEIT[zaehlung$TAGESZEIT  <= "06"] <- "morgen"
zaehlung$TAGESZEIT[zaehlung$TAGESZEIT  <= "12"] <- "vormittag"
zaehlung$TAGESZEIT[zaehlung$TAGESZEIT  <= "18"] <- "nachmittag"
zaehlung$TAGESZEIT[zaehlung$TAGESZEIT  <= "24"] <- "abend"

head(zaehlung)
```
```{r}
#calculate the total of movements of pedestrians and bikers hourly
aggregated_listFK <- aggregate(UNIDIR ~ FK_ZAEHLER + OST + NORD + FK_STANDORT + DATUM + TAGESZEIT, zaehlung, sum)

```

```{r}
#1.1.2 Prepare dataset Weather

#wetter$wind_force_avg_10min <- as.factor(wetter$wind_force_avg_10min)
#apply(wetter, MARGIN = 2, FUN = anyNA)

#only show hours not minutes
wetter$timestamp_cet <- str_sub(wetter$timestamp_cet, end = -7)

```
```{r}
#calculate the mean of wind force, air temperature and humidity per hour, and the sum of precipitation per hour

#aggregated_listWETTER <- aggregate(timestamp_cet ~ wind_force_avg_10min + air_temperature + precipitation, wetter, FUN = "mean")

aggregated_Wind <- aggregate(wind_force_avg_10min ~ timestamp_cet, wetter, FUN = mean)
aggregated_Temp <- aggregate(air_temperature ~ timestamp_cet, wetter, FUN = mean)
aggregated_Prec <- aggregate(precipitation ~ timestamp_cet, wetter, sum)
aggregated_Hum <- aggregate(humidity ~ timestamp_cet, wetter, FUN = mean)

#aggregate <- wetter$aggregated_Wind, wetter$aggregated_Temp, wetter$aggregated_Prec

aggregated_wetter_Wind_Temp <- left_join(aggregated_Wind, aggregated_Temp, by = "timestamp_cet")
aggregated_wetter_Wind_Temp_Prec <- left_join(aggregated_wetter_Wind_Temp, aggregated_Prec, by = "timestamp_cet")
aggregated_wetter_Wind_Temp_Prec_Hum <- left_join(aggregated_wetter_Wind_Temp_Prec, aggregated_Hum, by = "timestamp_cet")
head(aggregated_wetter_Wind_Temp_Prec_Hum)
#View(aggregated_wetter_Wind_Temp_Prec)

#aggregati <- aggregate(wetter$timestamp_cet)
#aggregati

```


```{r}
#1.1.3 joining both datasets together
join_zaehlung_wetter <- left_join(aggregated_listFK, aggregated_wetter_Wind_Temp_Prec_Hum, by = c("DATUM" = "timestamp_cet"))
head(join_zaehlung_wetter)
```

